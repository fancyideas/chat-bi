
-- 根据航班号、航班日期查询航班信息
SELECT
 t.ID,
 t.PID,
 t.OPT_AC_AIRLINE,
 t.OPT_FP_FLTNO,
 t.OPT_FP_DEP_AP,
 t.OPT_FP_ARR_AP,
 t.OPT_FP_EXECUTE_DATE,
 t.OPT_FP_SOBT,
 t.OPT_FP_SIBT,
 t.OPT_FS_CTOT,
 t.OPT_FS_ELDT,
 t.OPT_FS_ATOT,
 t.OPT_FS_ALDT,
 air.OPT_FL_AIRLINE_NAMECHN, --中文描述
 arr.OPT_FGS_STATION_NAMECHN,
 arr_city.OPT_FS_CITY_NAMECHN,
 dep.OPT_FGS_STATION_NAMECHN,
 dep_city.OPT_FS_CITY_NAMECHN,
 t.OPT_FS_STATUS AS "stateCn",
 t.SCT_STC_TERMINAL AS "terminal",
 t.OPT_FP_FLIN AS "optFpFlin"
FROM
 DW_OPT_FLIGHT t
LEFT JOIN DW_STATIC_RESOURCES_AIRLINE air ON
 t.OPT_AC_AIRLINE = air.OPT_FL_AIRLINE
LEFT JOIN DW_STATIC_RESOURCES_STATION dep ON
 t.OPT_FP_DEP_AP = dep.OPT_FGS_STATION
LEFT JOIN DW_STATIC_RESOURCES_STATION arr ON
 t.OPT_FP_ARR_AP = arr.OPT_FGS_STATION
LEFT JOIN DW_STATIC_RESOURCES_CITY dep_city ON
 dep.OPT_FL_CITY = dep_city.OPT_FL_CITY
LEFT JOIN DW_STATIC_RESOURCES_CITY arr_city ON
 arr.OPT_FL_CITY = arr_city.OPT_FL_CITY
WHERE
 t.OPT_FP_FLTNO = 'CA1519'
 AND t.OPT_FP_EXECUTE_DATE = DATE_FORMAT('2025-06-01', '%Y-%m-%d')


-- 根据起飞机场、到达机场、航班日期查询航班信息
SELECT
 t.ID,
 t.PID,
 t.OPT_AC_AIRLINE,
 t.OPT_FP_FLTNO,
 t.OPT_FP_DEP_AP,
 t.OPT_FP_ARR_AP,
 t.OPT_FP_EXECUTE_DATE,
 t.OPT_FP_SOBT,
 t.OPT_FP_SIBT,
 t.OPT_FS_CTOT,
 t.OPT_FS_ELDT,
 t.OPT_FS_ATOT,
 t.OPT_FS_ALDT,
 air.OPT_FL_AIRLINE_NAMECHN,
 arr.OPT_FGS_STATION_NAMECHN,
 arr_city.OPT_FS_CITY_NAMECHN,
 dep.OPT_FGS_STATION_NAMECHN,
 dep_city.OPT_FS_CITY_NAMECHN,
 t.OPT_FS_STATUS AS "stateCn",
 t.SCT_STC_TERMINAL AS "terminal",
 t.OPT_FP_FLIN AS "optFpFlin"
FROM
 DW_OPT_FLIGHT t
LEFT JOIN DW_STATIC_RESOURCES_AIRLINE air ON
 t.OPT_AC_AIRLINE = air.OPT_FL_AIRLINE
LEFT JOIN DW_STATIC_RESOURCES_STATION dep ON
 t.OPT_FP_DEP_AP = dep.OPT_FGS_STATION
LEFT JOIN DW_STATIC_RESOURCES_STATION arr ON
 t.OPT_FP_ARR_AP = arr.OPT_FGS_STATION
LEFT JOIN DW_STATIC_RESOURCES_CITY dep_city ON
 dep.OPT_FL_CITY = dep_city.OPT_FL_CITY
LEFT JOIN DW_STATIC_RESOURCES_CITY arr_city ON
 arr.OPT_FL_CITY = arr_city.OPT_FL_CITY
WHERE
 t.OPT_FP_EXECUTE_DATE = DATE_FORMAT('2025-06-01', '%Y-%m-%d')
 AND t.OPT_FP_DEP_AP = 'SHA'
 AND t.OPT_FP_ARR_AP = 'PEK'
 
-- 根据航班日期查询首都机场离港航班列表
SELECT
 t.ID,
 t.PID,
 t.OPT_AC_AIRLINE,
 t.OPT_FP_FLTNO,
 t.OPT_FP_DEP_AP,
 t.OPT_FP_ARR_AP,
 t.OPT_FP_EXECUTE_DATE,
 t.OPT_FP_SOBT,
 t.OPT_FP_SIBT,
 t.OPT_FS_CTOT,
 t.OPT_FS_ELDT,
 t.OPT_FS_ATOT,
 t.OPT_FS_ALDT,
 air.OPT_FL_AIRLINE_NAMECHN,
 arr.OPT_FGS_STATION_NAMECHN,
 arr_city.OPT_FS_CITY_NAMECHN,
 dep.OPT_FGS_STATION_NAMECHN,
 dep_city.OPT_FS_CITY_NAMECHN,
 t.OPT_FS_STATUS AS "stateCn",
 t.SCT_STC_TERMINAL AS "terminal",
 t.OPT_FP_FLIN AS "optFpFlin"
FROM
 DW_OPT_FLIGHT t
LEFT JOIN DW_STATIC_RESOURCES_AIRLINE air ON
 t.OPT_AC_AIRLINE = air.OPT_FL_AIRLINE
LEFT JOIN DW_STATIC_RESOURCES_STATION dep ON
 t.OPT_FP_DEP_AP = dep.OPT_FGS_STATION
LEFT JOIN DW_STATIC_RESOURCES_STATION arr ON
 t.OPT_FP_ARR_AP = arr.OPT_FGS_STATION
LEFT JOIN DW_STATIC_RESOURCES_CITY dep_city ON
 dep.OPT_FL_CITY = dep_city.OPT_FL_CITY
LEFT JOIN DW_STATIC_RESOURCES_CITY arr_city ON
 arr.OPT_FL_CITY = arr_city.OPT_FL_CITY
WHERE
 t.OPT_FP_EXECUTE_DATE = DATE_FORMAT('2025-06-01', '%Y-%m-%d')
 AND t.OPT_FP_MVIN = 'D'
 
-- 查询航班登机门信息
SELECT
 a.OPT_FS_BOARDING_GATE
FROM
 DW_OPT_FLIGHT t
LEFT JOIN DW_OPT_FLIGHT_GTDT a ON
 t.PID = a.PID AND t.OPT_FP_FLIN = a.OPT_FS_GTYP
WHERE
 t.OPT_FP_EXECUTE_DATE = DATE_FORMAT('2025-06-01', '%Y-%m-%d')
 AND t.OPT_FP_FLTNO = 'CA3576'
 
-- 查询航班值机柜台信息
SELECT
 a.OPT_FS_CHECK_IN_DESK
FROM
 DW_OPT_FLIGHT t
LEFT JOIN DW_OPT_FLIGHT_CKDT a ON
 t.PID = a.PID AND t.OPT_FP_FLIN = a.OPT_FS_CTYP
WHERE
 t.OPT_FP_EXECUTE_DATE = DATE_FORMAT('2025-06-01', '%Y-%m-%d')
 AND t.OPT_FP_FLTNO = 'CA3576'
 
-- 查询北京首都延误到达的航班信息
SELECT
 *
FROM
 DW_OPT_FLIGHT t
WHERE
 t.OPT_FP_EXECUTE_DATE = DATE_FORMAT('2025-06-01', '%Y-%m-%d')
 AND t.OPT_FP_MVIN = 'A'
 AND t.OPT_FS_STATUS = '延误'
 
-- 统计当日国际航班数量
SELECT
 COUNT(0)
FROM
 DW_OPT_FLIGHT t
WHERE
 t.OPT_FP_EXECUTE_DATE = DATE_FORMAT('2025-06-01', '%Y-%m-%d')
 AND t.OPT_FP_FLIN = 'I'
 
-- 查询当前航班的中转航班
SELECT
 *
FROM
 DW_OPT_FLIGHT f
WHERE
 f.OPT_FP_FLID = (
 SELECT
  t.OPT_FP_TAID
 FROM
  DW_OPT_FLIGHT t
 WHERE
  t.OPT_FP_EXECUTE_DATE = DATE_FORMAT('2025-06-01', '%Y-%m-%d')
   AND t.OPT_FP_FLTNO = 'CA1262')
   
-- 统计计划起飞时间与实际起飞时间相差10分钟以内的航班数量
SELECT COUNT(*)
FROM DW_OPT_FLIGHT t
WHERE DATEDIFF(MINUTE, TO_DATE(t.OPT_FP_SOBT, 'YYYY-MM-DD HH24:MI:SS'), TO_DATE(t.OPT_FS_ATOT, 'YYYY-MM-DD HH24:MI:SS')) < 10;

-- 计算某一天内的所有航班的实际起飞时间减计划起飞时间的平均值
SELECT AVG(DATEDIFF(MINUTE, TO_DATE(t.OPT_FP_SOBT, 'YYYY-MM-DD HH24:MI:SS'), TO_DATE(t.OPT_FS_ATOT, 'YYYY-MM-DD HH24:MI:SS'))) AS avg_time_difference
FROM DW_OPT_FLIGHT t
WHERE t.OPT_FP_EXECUTE_DATE = DATE_FORMAT('2025-06-01', '%Y-%m-%d');
